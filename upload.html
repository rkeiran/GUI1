<!--Ryan Keiran & Chris Keo
        Ryan_Keiran@student.uml.edu and christopher_keo@student.uml.edu
        Computer science department, UMass Lowell
        Comp 4610, GUI I
        Created: 12/5/17
        Updated: 12/13/17

This is our upload page. Images can be selected from local files, previewed, and uploaded to the gallery.-->

<html lang="en">	
	<head>
		<title>Upload</title>
        	<link rel="stylesheet" href="css/upload.css">
		<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>
		<script>
			$(document).ready(function (e) {
				$("#uploadimage").on('submit',(function(e) {
					e.preventDefault();
					$("#message").empty();
					$('#loading').show();
					$.ajax({
						url: "upload.php",
						type: "POST",
						data: new FormData(this),
						contentType: false,
						cache: false, 
						processData:false,
						success: function(data)	{
							$('#loading').hide();
							$("#message").html(data);
						}
					});
				}));

				// Function to preview image after validation
				$(function() {
					$("#file").change(function() {
						$("#message").empty(); // To remove the previous error message
						var file = this.files[0];
						var imagefile = file.type;
						var match= ["image/jpeg","image/png","image/jpg"];
						if(!((imagefile==match[0]) || (imagefile==match[1]) || (imagefile==match[2]))) {
							$('#previewing').attr('src','noimage.png');
							$("#message").html("<p id='error'>Please Select A valid Image File</p>"+"<h4>Note</h4>"+"<span id='error_message'>Only jpeg, jpg and png Images type allowed</span>");
							return false;
						}
						else {
							var reader = new FileReader();
							reader.onload = imageIsLoaded;
							reader.readAsDataURL(this.files[0]);
						}
					});
				});
				function imageIsLoaded(e) {
					$("#file").css("color","green");
					$('#image_preview').css("display", "block");
					$('#previewing').attr('src', e.target.result);
					$('#previewing').attr('width', '250px');
					$('#previewing').attr('height', '230px');
				};
			});
		</script>
	</head>
	
	<body>
				<form id="uploadimage" action="" method="post" enctype="multipart/form-data">
				<div id="image_preview"><img id="previewing" src="noimage.png" /></div>
				<hr id="line">
				<div id="selectImage">
				<label>Select Your Image</label><br/>
				<input type="file" name="file" id="file" required />
				<input type="submit" value="Upload" class="submit" />
				</div>
				</form>
				</div>
				<div id="message"></div>
                                <ul>
                         		<li><a href="final.php">BACK</a></li>
                                        <li><a href="final.php">PHOTOS</a></li>
		                        <li><a class="active" href="#upload">UPLOAD</a></li>
                		        <li><a href="share.html">SHARE</a></li>
				</ul>
	</body>
</html>
				
